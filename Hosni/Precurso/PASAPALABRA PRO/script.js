let questions = [
    {   
    letter: "a", 
    status: 0, 
    chooseQuestion:[
        {answer: "abducir",  question: "CON LA A. Dicho de una supuesta criatura extraterrestre: Apoderarse de alguien"},
        {answer: "anillas", question: "CON LA A. Aparato que se mueve en todas las direcciones."},
        {answer: "adn", question: "CON LA A. Molécula portadora de la información genética."}
        ] 
    },
    {
    letter: "b", 
    status: 0, 
    chooseQuestion:[
        {answer: "bingo", question: "CON LA B. Juego que ha sacado de quicio a todos los 'Skylabers' en las sesiones de precurso"},
        {answer: "biblioteca", question: "CON LA B. Lugar en el que se lleva a cabo el préstamo de libros."},
        {answer: "barometro", question: "CON LA B. Aparato para medir la presión atmosférica."}
    ]
    },
    {
    letter: "c",
    status: 0,
    chooseQuestion:[
        {answer: "churumbel", question: "CON LA C. Niño, crío, bebé"},
        {answer: "caries", question: "CON LA C. Destrucción del diente por falta de higiene."},
        {answer: "calleras", question: "CON LA C. Implemento que protege las manos."}
    ]
    },
    {
    letter: "d",
    status: 0,
    chooseQuestion:[
        {answer: "diarrea", question: "CON LA D. Anormalidad en la función del aparato digestivo caracterizada por frecuentes evacuaciones y su consistencia líquida"},
        {answer: "dificultad", question: "CON LA D. Valor de los elementos que hace un gimnasta en una competición."},
        {answer: "densidad", question: "CON LA D. Masa partido por volumen."}
    ]
    },
    {
    letter: "e",
    status: 0,
    chooseQuestion:[
        {answer: "ectoplasma", question: "CON LA E. Gelatinoso y se encuentra debajo de la membrana plasmática. Los cazafantasmas medían su radiación"},
        {answer: "enfermedad" , question: "CON LA E. Falta de salud."},
        {answer: "esguince", question: "CON LA E. Lesión habitual en los gimnastas."}
    ]
    },
    {
    letter: "f",
    status: 0,
    chooseQuestion:[
        {answer: "facil", question: "CON LA F. Que no requiere gran esfuerzo, capacidad o dificultad"},
        {answer: "fumar", question: "CON LA F. Hábito perjudicial para el aparato respiratorio."},
        {answer: "frutero", question: "CON LA F. Recipiente en el que se coloca la fruta."}
    ]
    },
    {
    letter: "g",
    status: 0,
    chooseQuestion:[
        {answer: "galaxia", question: "CON LA G. Conjunto enorme de estrellas, polvo interestelar, gases y partículas"},
        {answer: "galletas", question: "CON LA G. En nuestras reuniones no pueden faltar para el momento de la merienda compartida."},
        {answer: "guitarra", question: "CON LA G. Instrumento musical de seis cuerdas."}
    ]
    },
    {
    letter: "h",
    status: 0,
    chooseQuestion:[
        {answer: "harakiri", question: "CON LA H. Suicidio ritual japonés por desentrañamiento"},
        {answer: "hidrogeno", question: "CON LA H. Elemento qiímico de número atómico 1."},
        {answer: "hospitales", question: "CON LA H.  Lugares importantes, que tienen que ver con el derecho a la sanidad."}
    ]
    },
    {
    letter: "i",
    status: 0,
    chooseQuestion:[
        {answer: "iglesia", question: "CON LA I. Templo cristiano"},
        {answer: "infancia", question: "CON LA I. La etapa de la vida en la que estamos los niños y las niñas."},
        {answer: "invisible" , question: "CON LA I. Añade un prefijo a la palabra visible para obtener lo contrario."}
    ]
    },
    {
    letter: "j",
    status: 0,
    chooseQuestion:[
        {answer: "jabali", question: "CON LA J. Variedad salvaje del cerdo que sale en la película 'El Rey León', de nombre Pumba"},
        {answer: "jugar", question: "CON LA J. Es uno de nuestros derechos favoritos, es importante que todos los niños y niñas se diviertan haciéndolo."},
        {answer: "jueves", question: "CON LA J. Dia de la semana."}
    ]
    },
    {
    letter: "l",
    status: 0,
    chooseQuestion:[
        {answer: "licantropo", question: "CON LA L. Hombre lobo"},
        {answer: "libreria", question: "CON LA L. Lugar en el que se compran libros."},
        {answer: "lepra", question: "CON LA L. Enfermedad cutánea degenerativa."}
    ]
    },
    {
    letter: "m",
    status: 0,
    chooseQuestion:[
        {answer: "misantropo", question: "CON LA M. Persona que huye del trato con otras personas o siente gran aversión hacia ellas"},
        {answer: "medioambiente", question: "CON LA M. Forma parte de la vida, en el Consejo municipal nos preocupamos de cuidarlo haciendo acciones como el reciclaje."},
        {answer: "comba", question: "CONTIENE LA M. Juego que consiste en saltar por encima de una cuerda que se hace pasar por debajo de los pies y por encima de la cabeza de quien salta."}
    ]
    },
    {
    letter: "n",
    status: 0,
    chooseQuestion:[
        {answer: "necedad", question: "CON LA N. Demostración de poca inteligencia"},
        {answer: "naranja", question: "CON LA N. Del campo semántico de los colores y el nombre de una fruta con la que podemos hacer zumo."},
        {answer: "nucleo", question: "CON LA N. Compartimento celular donde se encuentra almacenada la información genética."}
    ]
    },
    {
    letter: "ñ",
    status: 0,
    chooseQuestion:[
        {answer: "señal", question: "CONTIENE LA Ñ. Indicio que permite deducir algo de lo que no se tiene un conocimiento directo."},
        {answer: "niñez", question: "CONTIENE LA Ñ. Etapa en la que estamos en un momento de la vida anterior a la adolescencia."},
        {answer: "bañera", question: "CONTIENE LA Ñ. Lugar donde Aquímedes descubrió la ley que lleva su nombre."}
    ]
    },
    {
    letter: "o",
    status: 0,
    chooseQuestion:[
        {answer: "orco", question: "CON LA O. Humanoide fantástico de apariencia terrible y bestial, piel de color verde creada por el escritor Tolkien"},
        {answer: "orejon", question: "CON LA O. Persona o animal con el pavellón auditivo muy desarollado."},
        {answer: "oveja", question: "CON LA O. Animal con abrigo de lana."}
    ]
    },
    {
    letter: "p",
    status: 0,
    chooseQuestion:[
        {answer: "protoss", question: "CON LA P. Raza ancestral tecnológicamente avanzada que se caracteriza por sus grandes poderes psíonicos del videojuego StarCraft"},
        {answer: "platino", question: "CON LA P. Elemento químico cuyo símbolo es Pt."},
        {answer: "poro", question: "CON LA P. Agujero de la piel."}
    ]
    },
    {
    letter: "q",
    status: 0,
    chooseQuestion:[
        {answer: "queso", question: "CON LA Q. Producto obtenido por la maduración de la cuajada de la leche"},
        {answer: "queratina", question: "CON LA Q. Proteína de las uñas"},
        {answer: "quemar", question: "CON LA Q. Hacer llamas. Combustionar."}
    ]
    },
    {
    letter: "r",
    status: 0,
    chooseQuestion:[
        {answer: "raton", question: "CON LA R. Pequeño roedor"},
        {answer: "repulsiva", question: "CON LA R. Tipo de fuerza que aparece al aproximarse dos cargas del mismo tipo"},
        {answer: "regla", question: "CON LA R. Instrumento para medir la longitud."}
    ]
    },
    {
    letter: "s",
    status: 0,
    chooseQuestion:[
        {answer: "stackoverflow", question: "CON LA S. Comunidad salvadora de todo desarrollador informático"},
        {answer: "sal", question: "CON LA S. Cloruro sódico."},
        {answer: "sangre", question: "CON LA S. Liquido rojo del cuerpo."}
    ]
    },
    {
    letter: "t",
    status: 0,
    chooseQuestion:[
        {answer: "terminator", question: "CON LA T. Película del director James Cameron que consolidó a Arnold Schwarzenegger como actor en 1984."},
        {answer: "terremoto", question: "CON LA T. Movimiento brusco del terreno."},
        {answer: "tormenta", question: "CON LA T. Fenómeno atmosférico y mujer mutante que tiene poderes climáticos."}
    ]
    },
    {
    letter: "u",
    status: 0,
    chooseQuestion:[
        {answer: "unamuno", question: "CON LA U. Escritor y filósofo español de la generación del 98 autor del libro 'Niebla' en 1914"},
        {answer: "uretra", question: "CON LA U. Conducto por donde la orina sale al exterior."},
        {answer: "universidad", question: "CON LA U. Lugar donde continuar los estudios tras terminar el Bachillerato."}
    ]
    },
    {
    letter: "v",
    status: 0,
    chooseQuestion:[
        {answer: "vikingos", question: "CON LA V. Nombre dado a los miembros de los pueblos nórdicos originarios de Escandinavia, famosos por sus incursiones y pillajes en Europa"},
        {answer: "velocidad", question: "CON LA V. Magnitud cuya unidad en el S.I. es el metro por segundo."},
        {answer: "volumen", question: "CON LA V. Espacio que ocupa un cuerpo."}
    ]
    },
    {
    letter: "x",
    status: 0,
    chooseQuestion:[
        {answer: "botox", question: "CONTIENE LA X. Toxina bacteriana utilizada en cirujía estética"},
        {answer: "experimentar", question: "CONTIENE LA X. Repetir la observación de un fenómeno en condiciones controladas, normalmente se hace en el laboratorio."},
        {answer: "explorar", question: "CONTIENE LA X. Examinar o reconocer a un paciente con fines diagnósticos."}
    ]
    },
    {
    letter: "y",
    status: 0,
    chooseQuestion:[
        {answer: "peyote", question: "CONTIENE LA Y. Pequeño cáctus conocido por sus alcaloides psicoactivos utilizado de forma ritual y medicinal  por indígenas americanos"},
        {answer: "inyectar", question: "CONTIENE LA Y. Introducir a presión un gas o un líquido en el interior de un cuerpo."},
        {answer: "yacimiento", question: "CON LA Y. Lugar donde se concentra una gran cantidad de minerales."}
    ]
    },
    {
    letter: "z",
    status: 0,
    chooseQuestion:[
        {answer: "zen", question: "CON LA Z. Escuela de budismo que busca la experiencia de la sabiduría más allá del discurso racional"},
        {answer: "luz", question: "CONTIENE LA Z. Agente físico que hace visible los objetos."},
        {answer: "zancadilla", question: "CON LA Z. Si te hacen una, podrias caer y hacerte daño."}
    ]
    }
];

let userRanking = [];

let userName;
let objPlayer = {userName: "", correctAnswers: 0, failAnswers: 0};

let itsEnd = false;
let letra = 0;

let time = 180;
let countDown;


function askUserName() { 
    visibleButton();
}

function bienvenido() {
    document.getElementById("userNameInput").style.display = "none";
    document.getElementById("start").style.visibility = "visible";
    document.getElementById("bienvenido").innerHTML = `Bienvenido/a ${userName} al juego PASAPALABRA SKYLAB!`;
}

function startPlay(value) { 
    zeroTimer(time)
    if(document.getElementById("game").style.visibility != "visible"){ //mostrar div preguntas

        document.getElementById("start").style.display = "none";
        document.getElementById("game").style.visibility = "visible";

        document.getElementById('answer').focus();

        document.onkeydown = function(e) {
            switch(e.key) {
                case " ":
                    document.getElementById("answer").value = "PASAPALABRA";
                    validar(letra);
                    break;
                case "Enter": 
                    validar(letra);
                    break;
                case "Escape":
                    salirJuego();
                    break;
            }
        }
    }

    if(time === 180) {
        countDown = setInterval(function myTimer() {
      
            time -= 1;
            zeroTimer(time)
    
            if(time === 0){
                finalirtzar();
                clearTimeout(countDown);
                cleanDisplay("none");
                visibleFinishPoints();
            }
        }, 1000);
    }
    let statusValue = questions[value].status;
    switch(statusValue) {
        case 0:
            preguntaSinRespuesta(value);
            break;
        case "pasapalabra":
            preguntaGuardada(value);
            break;
    }    
}
function zeroTimer(time) {
    if(time < 10) {
        return document.getElementById("timer").innerHTML = "00" + time; 
    }else if(time < 100) {
        return document.getElementById("timer").innerHTML = "0" + time;
    }else{
        return document.getElementById("timer").innerHTML = time;
    }
}

function preguntaSinRespuesta(value) {
    
    let randomQuestionNum = Math.floor(Math.random() * 3); 
    let pregunta = questions[value].chooseQuestion[randomQuestionNum].question;
    questions[value].numberQuestion = randomQuestionNum;
    // sameQuestion = randomQuestionNum;

    document.getElementById("question").innerHTML = pregunta;

}

function preguntaGuardada(value) {
    
    let repeatNumQuestion = questions[value].numberQuestion;
    let pregunta = questions[value].chooseQuestion[repeatNumQuestion].question;
    document.getElementById("question").innerHTML = pregunta;
}   

function validar(value) {
    respuesta = document.getElementById("answer").value;
    respuesta = respuesta.toUpperCase();
    let sameQuestion = questions[value].numberQuestion
    let isTrue = questions[value].chooseQuestion[sameQuestion].answer;
    if(questions[value].status == "pasapalabra"){
        let numberQuestion = questions[value].numberQuestion;
        isTrue = questions[value].chooseQuestion[numberQuestion].answer
    }
    respuesta = respuesta.replace(" ", "");//trampillaaaaa (supongo que es un preset del chrome)
    isTrue = isTrue.toUpperCase();
    
    switch(respuesta){
        case 'PASAPALABRA': 
            pasapalabra(value);
            break;
        case isTrue:
            correct(value);
            break;
        default:
            isFalse(value);
            break;
    }    
    document.getElementById("answer").value = "";
    checkStatus()
}

function salirJuego() {
    clearTimeout(countDown);
    document.getElementById("timer").innerHTML = "000";
    theEnd();
    checkStatus();
}

  
function checkStatus() {
    
    if((objPlayer.failAnswers + objPlayer.correctAnswers) < questions.length) {
        if(letra > (questions.length - 1)) {
            letra = 0;
        }
        let status = questions[letra].status;

        while (status !== 0 && status != "pasapalabra"){//0= no respondido
            letra += 1;

            if(letra > (questions.length - 1)) {
                letra = 0;
            }

            status = questions[letra].status;
        }

        startPlay(letra);

    }else {//todas las preguntas respondidas. 

            cleanDisplay("none");
            visibleFinishPoints();
    }        
}

function visibleFinishPoints () {
    const divPlayAgain = document.getElementById("play-again");
    const pointMessage = document.getElementById("final-result-message");

    const endGame = document.createTextNode('Ha abandonado la partida, con un total de aciertos de: ' + objPlayer.correctAnswers);   
    
    const resultMessage = document.createTextNode(`${userName}, tu resultado és: ${objPlayer.correctAnswers} Aciertos y ${objPlayer.failAnswers} fallos.`);   
    if(pointMessage.textContent !== ""){
        pointMessage.textContent = "";
    }

    divPlayAgain.style.visibility = "visible";
    
    if(itsEnd === true) {
        document.getElementById("visible-ranking").style.display = "none";
        pointMessage.append(endGame);
    }else{
        userRanking.push(objPlayer);

        document.getElementById("visible-ranking").style.display = "initial";

        pointMessage.append(resultMessage);
    }
}

function cleanDisplay(displayValue) {
    document.getElementById("userNameInput").style.display = displayValue;
    document.getElementById("start").style.display = displayValue;
    document.getElementById("game").style.display = displayValue;
    document.getElementById("initial-message").style.display = displayValue;

    if(displayValue === "initial") {
         document.getElementById("start").style.visibility = "hidden";
         document.getElementById("game").style.visibility = "hidden";
         document.getElementById("play-again").style.visibility = "hidden";
         document.getElementById("div-ranking").style.display = "none";
    }
}

function ranking() {

    const divRanking = document.getElementById("div-ranking");
    divRanking.style.display = "initial";
    
    let tableElement = document.getElementById("ranking-id")

    if (tableElement !== null) {//aqui algo patina, funciona pero patina. mirar tableElement /sources/watch no s'elimina.

        document.getElementById("ranking-id").remove(); 

    }
    
    const createTable = document.createElement("table");
    createTable.classList.add("ranking-clss");
    createTable.id = "ranking-id";

    const createTr = document.createElement("tr");

    const createThUser = document.createElement("th");
    const createThRight = document.createElement("th");
    const createThFail = document.createElement("th");

    const printUserTh = document.createTextNode("USUARIO");
    const printRightTh = document.createTextNode("ACIERTOS");
    const printFailTh = document.createTextNode("FALLOS");

    createThUser.append(printUserTh);
    createThRight.append(printRightTh);
    createThFail.append(printFailTh);

    createTr.append(createThUser);
    createTr.append(createThRight);
    createTr.append(createThFail);

    createTable.append(createTr);
    divRanking.append(createTable);

    const higherThan = userRanking.sort((a, b) => b.correctAnswers - a.correctAnswers);//ordena de major a menor

    higherThan.forEach(function (rankingPlayers){//puc crear la table dintre de la iteracio amb un condicional if(quan no hi ha element <table> creala. surts i segueixes fent els <tr><td>)

        const createNewTr = document.createElement("tr")//crea nova linea de la taula
        createNewTr.classList.add("ranking-tr");

        const createUserTd = document.createElement("td");
        createUserTd.classList.add("ranking-td");

        const createRightTd = document.createElement("td");
        createRightTd.classList.add("ranking-td");
        
        const createFailTd = document.createElement("td");
        createFailTd.classList.add("ranking-td");

        const printUserTd = document.createTextNode(rankingPlayers.userName);
        const printCorrectAnswerTd = document.createTextNode(rankingPlayers.correctAnswers);
        const printFailAnswerTd = document.createTextNode(rankingPlayers.failAnswers);

        createUserTd.append(printUserTd);
        createRightTd.append(printCorrectAnswerTd);
        createFailTd.append(printFailAnswerTd);

        
        createNewTr.append(createUserTd);
        createNewTr.append(createRightTd);
        createNewTr.append(createFailTd);
        
        createTable.append(createNewTr);
        
        divRanking.style.visibility = "visible";
    }) 
}

function playAgain() {
    document.getElementById("timerOff").innerHTML = "";
    document.getElementById("div-ranking").style.visibility = "hidden";

    const abc = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'L', 'M', 'N', 'Ñ', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'X', 'Y', 'Z'];
    abc.forEach(function (letra){
        document.getElementById(letra).style.backgroundColor = "rgba(7, 7, 146, 0.733)";
    })

    objPlayer = {userName: "", correctAnswers: 0, failAnswers: 0};

    for(i in questions) {
        questions[i].status = 0;
    }
    time = 180;
    document.getElementById("timer").innerHTML = "";
    itsEnd = false;
    letra = 0;
    cleanDisplay("initial")
   
    askUserName();
}

function visibleButton() {
    document.getElementById("askNameButton").style.display = "none";
    document.getElementById("userNameInput").style.visibility = "visible";
    document.getElementById("userName").focus();

  }

function checkUserName() { 

    userName = document.getElementById("userName").value;
    if (userName === '') {
        document.getElementById("userNameLabel").innerHTML = 'No ha introducido un nombre de usuario. \n Vuelva a intentarlo.';
    }else{
        bienvenido();
        objPlayer.userName = userName;
    }
}

function setColor(value) {
    const abc = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'L', 'M', 'N', 'Ñ', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'X', 'Y', 'Z'];
    let buscarLetra = abc[value];
    switch(questions[value].status){
        case true:
            document.getElementById(buscarLetra).style.backgroundColor = "green";
            break;
        case false:
            document.getElementById(buscarLetra).style.backgroundColor = "red";
            break;
    }
}

function pasapalabra(value){
    questions[value].status = "pasapalabra";
    // questions[value].numberQuestion = sameQuestion;//añadir una propiedad al objeto para 
    letra += 1;
}

function correct(value) {
    questions[value].status = true;
    objPlayer.correctAnswers += 1;
    setColor(value);
    letra += 1;
}

function theEnd(){
    for(i in questions) {
        if(questions[i].status === 0 || questions[i].status == "pasapalabra") {
            questions[i].status = false;
            objPlayer.failAnswers += 1;
        }
    }
    itsEnd = true;
}

function isFalse(value){
    questions[value].status = false;
    objPlayer.failAnswers += 1;
    setColor(value);
    letra += 1;
}

function finalirtzar() {
	document.getElementById("timerOff").innerHTML = "TIEMPO!";  
 		}